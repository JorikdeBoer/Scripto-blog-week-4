<!DOCTYPE html>

<html>
    <head>
        <!-- The comment page of the Scripto blog application -->
        <title>	Scripto Blog application </title>
        
        <!-- Link to css style file -->
        <link type="text/css" rel="stylesheet" href="Comment4.css" />
	    <meta charset="utf-8">
          
        <script>                   
        </script>     
     </head>
        
 
    <script>
    // Test getblogtitles function
    getblogtitles();

        
    //Global variable
    var chosen_blog = document.bloginput.blog.value;
        
    // Send written comment to database 
    function submitcomment() {
        var comment = document.bloginput.text.value;  
        var titel_blog= document.bloginput.title.value; 
        var xhr = new XMLHttpRequest();  
        var value = "mycomment=" + comment + "&titel_blog=" + titel_blog;
        xhr.open('POST', "http://localhost/Scripto4/Scripto4.php", true); 
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');  
        console.log(value);
        xhr.send(value);       
    }
        
    // Get comments from certain blog from database to publish on site
    function getblogcomments() {
        var xhr = new XMLHttpRequest();     
        var titel_blog = document.output.blog.value;
        console.log(titel_blog);
        var url = "http://localhost/Scripto4/Scripto4.php?titel_blog="+titel_blog;
        xhr.open('GET', url, true);
        xhr.onload = function (e) {
            if (xhr.readyState === xhr.DONE) {
                if (xhr.status === 200) {
                    // The reponse contains all blogs from the input category in the databse 
                    // with author, title and blog (ordered by descending ID numbers)    
                    document.output.outputtext.value =
                    xhr.response;
                    console.log(xhr.responseText);
                } 
                else {
                    console.error(xhr.statusText);
                } 
            }
        }; 
        xhr.onerror = function (e) {
              console.error(xhr.statusText);
        };
        xhr.send(null); 
    }   
        
    // Get all blogtitles
    function getblogtitles() {  
        var xhr = new XMLHttpRequest();     
        var all_blogs = "all_blogs";
        var url = "http://localhost/Scripto4/Scripto4.php?all_blogs="+all_blogs;
        xhr.open('GET', url, true);
        xhr.onload = function (e) {
            if (xhr.readyState === xhr.DONE) {
                if (xhr.status === 200) {
                    // The reponse contains all blogs from the input category in the databse 
                    // with author, title and blog (ordered by descending ID numbers)    
                    //document.output.outputtext.value =
                    //xhr.response;
                    console.log(xhr.responseText);
                    var output = xhr.response;
                    return output;
                } 
                else {
                    console.error(xhr.statusText);
                } 
            }
        }; 
        xhr.onerror = function (e) {
              console.error(xhr.statusText);
        };
        xhr.send(null); 
    }
        
    // Make autocomplete text epander possible
    // self defined shortcuts list    
    shortcuts = {
        "ivm" : "in verband met",
        "tov" : "ten opzichte van",
        "muv" : "met uitzondering van", 
        "cg"  : "CodeGorilla",
        "gn"  : "Groningen",
        "ioc" : "Internationaal Olympisch Comité",
        "jan" : "januari",
        "feb" : "februari",
        "mrt" : "maart",
        "apr" : "april",
        "jun" : "juni",
        "jul" : "juli",
        "aug" : "augustus",
        "sep" : "september",
        "okt" : "oktober",
        "nov" : "november",
        "dec" : "december"   
    }
        
    // couple text area with shortcuts
    window.onload = function() {
        var ta = document.getElementById("submit");
        var timer = 0;
        var re = new RegExp("\\b(" + Object.keys(shortcuts).join("|") + ")\\b", "g");

        update = function() {
            ta.value = ta.value.replace(re, function($0, $1) {
            return shortcuts[$1.toLowerCase()];
            });
        }
        // constant update
        ta.onkeydown = function() {
        clearTimeout(timer);
        timer = setTimeout(update, 200);
        }
    }           
    </script>  
    
    <!-- Insert background with clouds -->
    <body background="achtergrond.jpg"> 
      <!--Build-up of comment page -->
      <div id="Total">
        <div id="Menu">
            <div id="Welcome">
                <!-- Name and slogan of the blog app -->
                <p class="welcome"> <b> Scripto: jouw blog applicatie, jouw geschriften! </b></p>
                <div style="clear:both"></div>
            </div>     

            <!-- Navigation bar links -->
            <div class="topnav">
                <a href="Index4.html">Menu</a>
                <a href="Category4.html">Categorieën</a>
                <a href="Scripto4.html">Schrijf zelf!</a>
                <a href="Comment4.html">Commentaar</a>
                <div style="clear:both"></div>  
            </div>    
            
            <!-- Inputbox: Your written comment with title of the blog the comment is directed to & your comment itself-->
            <div id="Inputbox"> 
             <h1>Schrijf hier je commentaar!</h1>
              <form name="bloginput" action="" method="post">  
                Titel van bijbehorende blog: <input type="text" name="title"><br><br>
                Jouw commentaar: <textarea id="submit" name="text" rows="5" cols="90"></textarea>
                <!-- Button to submit the new written blog to the database -->
                <input type="button" name="publiceer" onClick="submitcomment();" value="Publiceer commentaar" />
              </form><br><br> 
            
            <!-- Outputbox: All the commets for a certain blog -->
            <form name="output" action="">  
              <div id="Outputbox">    
                <div class="column">
                <h1>Lees hier het laatste commentaar, wellicht van uw hand!</h1>
                 Titel van bijbehorende blog:<input name="blog" type="text" list="blogs" />
                <datalist id="blogs">
                  <option value="Commentaar">Commentaar</option>
                </datalist><br><br>     
                  <textarea name="outputtext" cols="90" rows="12">
                  </textarea>
                <!-- Button to refresh the outputbox to include new posted blogs since page was loaded --> 
                <input type="button" name="ververs" onClick="getblogcomments()" value="Ververs comments" />    
                </div>
              </div> 
            </form>    
            </div> 
        </div>
      </div>       
    </body>
</html>